{% extends "web.html" %}
{% block title %}Telegram Bot{% endblock %}

{% block html_head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/telegram_card.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/telegram_bot_card.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/payment_card.css') }}">
{% endblock %}

{% block telegram_auth %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row g-4">
        <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram –±–æ—Ç–æ–º -->
        <div class="col-md-4">
            <div class="telegram-bot-card p-3 rounded-3">

                <h5 class="text-center mb-3 telegram-bot-title">
                    Telegram –±–æ—Ç
                </h5>

                <!-- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
                <div class="bot-status mb-3 text-center">
                    <span class="status-dot {{ 'online' if bot_is_running else 'offline' }}"></span>
                    <span class="status-text">
                        {{ "–†–∞–±–æ—Ç–∞–µ—Ç" if bot_is_running else "–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" }}
                    </span>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <button
                    class="btn bot-toggle-btn w-100 mb-3
                        {{ 'btn-stop' if bot_is_running else 'btn-start' }}"
                    id="toggleBotBtn"
                >
                    {{ "‚õî –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞" if bot_is_running else "‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞" }}
                </button>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ -->
                <div class="mb-2">
                    <label class="form-label small fw-semibold">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</label>
                    <input
                        type="text"
                        class="form-control form-control-sm bot-code-input"
                        id="botCodeInput"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram"
                    >
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–¥–∞ -->
                <button
                    class="btn btn-primary btn-sm w-100 mb-3"
                    id="applyBotCodeBtn"
                >
                    ‚úàÔ∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥
                </button>

                <!-- –°—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="bot-message info" id="botCodeMessage">
                    –°—Ç–∞—Ç—É—Å...
                </div>

            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ Telegram Info -->
        <div class="col-md-4">
            <div class="p-3 rounded-3 telegram-info-card">

                <div class="pc-icon">üíª</div>
                <div class="disk-icon">üíø</div>

                <h5 class="telegram-card-title text-center mb-3">
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è Telegram
                </h5>

                <ul class="list-unstyled mb-0 text-center telegram-info-list">
                    <li class="mb-2">
                        <strong>API ID:</strong><br>
                        <span id="tg-api-id">
                            {{ user.api_id if user.api_id else "–ù–µ –∑–∞–¥–∞–Ω–æ" }}
                        </span>
                    </li>

                    <li class="mb-2">
                        <strong>API Hash:</strong><br>
                        <span id="tg-api-hash">
                            {{ user.api_hash if user.api_hash else "–ù–µ –∑–∞–¥–∞–Ω–æ" }}
                        </span>
                    </li>

                    <li class="mb-2">
                        <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong><br>
                        <span id="tg-phone">
                            {{ user.phone if user.phone else "–ù–µ –∑–∞–¥–∞–Ω" }}
                        </span>
                    </li>

                    <li>
                        <strong>2FA –ø–∞—Ä–æ–ª—å:</strong><br>
                        <span id="tg-2fa">
                            {{user.password_2fa if user.password_2fa else "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" }}
                        </span>
                    </li>

                </ul>

            </div>
        </div>
        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –û–ø–ª–∞—Ç–∞ -->
        <div class="col-md-4">
            <div class="p-3 rounded-3 payment-card">

                <div class="frog-icon">üê∏</div>
                <div class="tree-icon">üå≥</div>

                <h5 class="payment-card-title text-center mb-3">
                    –û–ø–ª–∞—Ç–∞
                </h5>

                <div class="payment-card-date text-center">
                    <div class="label">–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ</div>
                    
                    {% set time_diff = (user.paid_until - FUNC_CURRENT_TIME_UTC()).total_seconds() if user.paid_until else -1 %}
                    {% if time_diff < 0 %}
                        <div class="value" style="color: #5900ff;">
                            {{ user.paid_until.strftime("%H:%M:%S %d.%m.%Y") }} (–ò—Å—Ç–µ–∫–ª–∞)
                        </div>
                    {% elif time_diff < 93600 %} {# 93600 —Å–µ–∫ = 26 —á–∞—Å–æ–≤ (1 –¥–µ–Ω—å + 2 —á–∞—Å–∞) #}
                        <div class="value" style="color: red;">
                            {{ user.paid_until.strftime("%H:%M:%S %d.%m.%Y") }}
                        </div>
                    {% else %}
                        <div class="value" style="color: green;">
                            {{ user.paid_until.strftime("%H:%M:%S %d.%m.%Y") }}
                        </div>
                    {% endif %}

                </div>
            </div>
        </div>


{% endblock %}

{% block scripts_js %}
    <script src="{{ url_for('static', filename='js/telegram_bot_run.js') }}"></script>
{% endblock %}